<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fake News Prediction</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <div class="container mx-auto p-4 md:p-8 max-w-3xl">
      <header class="text-center mb-8">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900">
          Fake News Detector
        </h1>
        <p class="text-lg text-gray-600 mt-2">
          Enter a news article below to analyze its likelihood of being
          misleading.
        </p>
      </header>

      <main>
        <div class="bg-white p-6 rounded-2xl shadow-lg w-full">
          <label for="news-article" class="sr-only">News Article</label>
          <textarea
            id="news-article"
            rows="10"
            class="w-full p-4 text-base text-gray-700 bg-gray-50 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-300"
            placeholder="Paste the news article text here..."
          ></textarea>
          <div class="mt-4">
            <button
              id="predict-btn"
              class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out"
            >
              Analyze News
            </button>
          </div>
        </div>

        <div
          id="result-container"
          class="mt-8 bg-white p-6 rounded-2xl shadow-lg w-full hidden"
        >
          <h2 class="text-2xl font-bold text-gray-900 mb-4">Analysis Result</h2>
          <div id="loader" class="flex justify-center items-center h-32 hidden">
            <div class="loader"></div>
          </div>
          <div id="result-content">
            <!-- Results will be injected here -->
          </div>
        </div>
      </main>
    </div>

    <script>
      const predictBtn = document.getElementById("predict-btn");
      const newsArticleTextarea = document.getElementById("news-article");
      const resultContainer = document.getElementById("result-container");
      const resultContent = document.getElementById("result-content");
      const loader = document.getElementById("loader");

      predictBtn.addEventListener("click", handleAnalysis);

      async function handleAnalysis() {
        const articleText = newsArticleTextarea.value.trim();
        if (!articleText) {
          resultContent.innerHTML = `<p class="text-red-500">Please paste a news article first.</p>`;
          resultContainer.classList.remove("hidden");
          return;
        }

        resultContainer.classList.remove("hidden");
        resultContent.innerHTML = "";
        loader.classList.remove("hidden");

        // This is your local backend endpoint
        const apiUrl = `http://127.0.0.1:8000/predict`;

        const payload = {
          text: articleText,
        };

        try {
          const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            throw new Error(`API error: ${response.statusText}`);
          }

          const result = await response.json();

          if (result.prediction && result.confidence !== undefined) {
            // Display the result from your backend
            const predictionColor =
              result.prediction === "Real" ? "text-green-600" : "text-red-600";
            resultContent.innerHTML = `
                        <p class="text-lg"><strong>Prediction:</strong> <span class="${predictionColor} font-semibold">${result.prediction}</span></p>
                        <p class="text-lg mt-2"><strong>Confidence:</strong> ${result.confidence}%</p>
                    `;
          } else {
            throw new Error("Invalid response structure from API.");
          }
        } catch (error) {
          console.error("Error during analysis:", error);
          resultContent.innerHTML = `
                    <p class="text-red-500 font-semibold">Error: Connection Failed</p>
                    <p class="text-gray-600 mt-2">Could not connect to the analysis server. This is a common problem when a web page tries to access a local server. Please check these possibilities:</p>
                    <ul class="list-disc list-inside mt-2 text-gray-600 space-y-2">
                        <li><strong>Is your local server running?</strong> Make sure your Python server is active and listening on <strong>http://127.0.0.1:8000</strong>.</li>
                        <li><strong>CORS Policy:</strong> Your server needs to allow requests from this webpage. You may need to add CORS middleware to your Python/FastAPI application.</li>
                        <li><strong>Mixed Content:</strong> This web page is secure (HTTPS), but your server is not (HTTP). Browsers often block these requests for security. Try running your local server with HTTPS if possible.</li>
                    </ul>
                    <p class="text-gray-500 mt-4 text-sm">See the browser's developer console (F12) for more specific error messages.</p>
                `;
        } finally {
          loader.classList.add("hidden");
        }
      }
    </script>
  </body>
</html>
